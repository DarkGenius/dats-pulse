# Исправления системы движения

## Проблемы, которые были исправлены:

1. **Отсутствие проверки занятости гексов** - юниты пытались пройти через занятые клетки
2. **Использование излишне сложных кубических координат** - для 2D гексагональной сетки достаточно аксиальных координат (q, r)
3. **Отправка только первого шага пути** - API ожидает полный путь для лучшего планирования

## Реализованные решения:

### 1. PathfindingValidator
Новый класс для валидации путей с учетом всех игровых ограничений:
- Проверка занятости гексов (враги, союзники того же типа)
- Проверка примыкания гексов
- Учет очков движения
- Поиск альтернативных путей при блокировке

### 2. Упрощенный алгоритм построения пути
- Используются только аксиальные координаты (q, r)
- Пошаговое движение к цели через соседние гексы
- Учет 6 направлений движения в гексагональной сетке

### 3. Корректная отправка данных в API
- Отправляется полный путь `path: [{q, r}, ...]` вместо одной точки
- ApiClient поддерживает обратную совместимость

## Правила движения, которые теперь соблюдаются:

1. ✅ Нельзя зайти на гекс с вражеским юнитом
2. ✅ Нельзя зайти на гекс с дружественным юнитом того же типа
3. ✅ Движение только на примыкающие гексы
4. ✅ Учет очков движения (скорости юнита)

## Алгоритм движения:

```javascript
1. Построить прямой путь к цели
2. Проверить каждый шаг на валидность:
   - Гекс свободен или занят союзником другого типа
   - Гекс примыкает к текущей позиции
   - Хватает очков движения
3. Если путь заблокирован:
   - Найти альтернативный путь через доступные соседние гексы
   - Выбрать гекс, приближающий к цели
4. Отправить валидный путь в API
```

Теперь юниты корректно обходят препятствия и не застревают при столкновениях.